# 본문의 글은 인프런 앨런 Swift문법 마스터 스쿨(온라인) 부트캠프의 강의 영상을 본후 공부한 내용을 정리하여 기록한것입니다.
https://inf.run/YyoR

동시성프로그래밍과 관련된 문제점   
1. 경쟁상황/경쟁조건 (Race condition)   

```swift

/* 
경쟁상황이란 각자의 스택에서 일을 하는데 데이터나 힙 같은 공유되는 메모리에 동시에 접근할때 즉 
예를들어 2번쓰레드에서는 뭔가 힙에 인스턴스에 값을 바꾸려고하는데 3번쓰레드에서는 힙에 인스턴스의 값을 그냥 읽으려고하면?
아주 미세한 0.0000 몇초동안 과연 읽는게먼저인지 값을바꾸는게먼저인지 헷갈릴수 있다. 
하나의 메모리에 서로 다른 쓰레드에서 동시에접근했을때를 경쟁상황 경쟁조건이라고 한다. => Thread-safe 하지않다.
이런경우를 방지하고자 동시에 접근하지못하게 열쇠를 걸어 잠그는(Lock) 코드들도 존재를 한다.
이것뿐만아니라 여러 가지 방지법도 있긴 있다
*/
```

2. 교착상태(DeakLocs)   

```swift
/*
교착상태란 예를들어 힙에 인스턴스1번이 있고 인스턴스 2번이 있다고 가정해보자
2번쓰레드에서 인스턴스1번의 값을 바꾸고 있고 동시에 3번쓰레드에서 인스턴스2번의 값을 바꾸고 있다면
그리고 쓰레드 세이프하게 잠궈뒀다고 또 가정해보자
그런데 이런상황에서 어떤 2번쓰레드의 함수가 인스턴스1번의값과 인스턴스2번의값을 동시에 바꾸려고 한다면?
하지만 잠궈버렸기때문에 2번쓰레드는 접근할수가 없다.
또한 3번쓰레드 역시 인스턴스1번의값과 인스턴스2번의값을 동시에 바꾸려고 한다면?
서로가 서로의 잠궈진 인스턴스 값에 접근하려고하니까 
2번쓰레드 3번쓰레드의 메서드 자체가 작업을 끝내지 못해버린다. 갑자기 앱이 멈처버린다..
이런 상태를 교착상태라고 한다.



2개 이상의 쓰레드가 서로 베타적인 메모리의 사용으로 인해(서로잠그고 점유하고) 메서드의 작업이 종료되지못하고 일이 멈처버리는 상황
*/
```

쓰레드 세이브하지않을때 해결법
```swift
//1. 쓰레드 세이프하지않을 때 일반정인 해결 방법
//메모리에 동시접근할거 같은상황을 동시큐에서 직렬큐로 보낸다

// 배열은 여러쓰레드에서 동시에 접근하면 문제가 생길 수 있다.


var array = [String]() //빈문자열 //메모리공간에 하나만 존재함

let serialQueue = DispatchQueue(label: "serial") //직렬큐를 하나 생성


for i in 1...20 {
    DispatchQueue.global().async { //반복문을 통해서 비동기적으로 프린트하는것
        print("\(i)")
        array.append("\(i)")    //  <===== 동시큐에서 실행하면 동시다발적으로 하나만 있는 배열의 메모리에 접근해서 추가하기
        
//        serialQueue.async {        // 올바른 처리 ⭐️
//            array.append("\(i)")  //추가를 하나의 쓰레드로 직렬처리로 보내버리는것
//        }
    }
}




// 5초후에 배열 확인하고 싶은 코드 일뿐...

DispatchQueue.main.asyncAfter(deadline: .now() + 5) { //asyncAfter 몇초후에 비동기적으로 실행해라 이런거.
    print(array)
//    PlaygroundPage.current.finishExecution()
}
//실행을 해보면 어떤 값이 빠지는경우가 있음.
//이런상황을 해결하기위해 직렬큐로 보내는것
```
